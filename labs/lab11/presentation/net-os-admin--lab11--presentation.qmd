---
## Author
author:
  name: Ибрахим Мохсейн Алькамаль
  degrees: Student (3 курс)
  orcid: ""
  email: 1032225432@pfur.ru
  affiliation:
    - name: Российский университет дружбы народов
      country: Российская Федерация
      postal-code: 117198
      city: Москва
      address: ул. Миклухо-Маклая, д. 6
## Title
title: Лабораторная работа №11
subtitle: "Дисциплина: Администрирование сетевых подсистем "
license: CC BY
date: today
date-format: "YYYY-MM-DD" # Example: 2025-09-06
---

# Цель работы
## Цель работы

- Приобретение практических навыков настройки удалённого доступа по SSH
- Повышение безопасности доступа к серверу

# Выполнение лабораторной работы

## Запрет удалённого доступа по SSH для пользователя root

- Выполнен вход с административными привилегиями
- Задан пароль пользователю root (`passwd root`)
- Получено предупреждение о длине пароля
- Пароль успешно обновлён

![Изменение пароля пользователя root с помощью passwd](image/1.png){#fig-1 width=70%}

---

- С клиента выполнено `ssh root@server.alkamal.net`
- Получена ошибка `Permission denied`
- Доступ отклонён сервером

![Отказ в аутентификации при SSH-подключении пользователя root](image/2.png){#fig-2 width=70%}

---

- В `sshd_config` установлен `PermitRootLogin no`
- Запрещён удалённый вход root

![Параметр PermitRootLogin no в файле sshd\_config](image/3.png){#fig-3 width=70%}

---

- Выполнен перезапуск `sshd`
- Повторная попытка входа завершилась ошибкой
- Подтверждён запрет доступа root

![Повторная ошибка SSH-аутентификации после запрета входа root](image/4.png){#fig-4 width=70%}



## Ограничение списка пользователей для удалённого доступа по SSH

- Выполнено подключение `ssh alkamal@server.alkamal.net`
- Аутентификация прошла успешно

![Успешное SSH-подключение пользователя alkamal к серверу](image/5.png){#fig-5 width=70%}

---

- В `sshd_config` добавлена строка `AllowUsers vagrant`
- Ограничен список разрешённых пользователей

![Добавление директивы AllowUsers vagrant в sshd\_config](image/6.png){#fig-6 width=70%}

---

- Выполнен `systemctl restart sshd`
- Применена новая конфигурация

![Перезапуск службы sshd после изменения конфигурации](image/7.png){#fig-7 width=70%}

---

- Повторное подключение alkamal завершилось ошибкой
- Пользователь отсутствует в `AllowUsers`

![Отказ в SSH-доступе пользователю alkamal после ограничения AllowUsers](image/8.png){#fig-8 width=70%}

---

- Строка изменена на `AllowUsers vagrant alkamal`
- Пользователь добавлен в разрешённый список

![Расширение списка AllowUsers: vagrant alkamal](image/9.png){#fig-9 width=70%}

---

- После перезапуска `sshd` подключение успешно
- Подтверждён доступ alkamal

![Успешное SSH-подключение после добавления пользователя в AllowUsers](image/10.png){#fig-10 width=70%}



## Настройка дополнительных портов для удалённого доступа по SSH

- В `sshd_config` добавлена строка `Port 2022`
- Настроено прослушивание портов 22 и 2022

![Добавление порта 2022 в конфигурацию sshd](image/11.png){#fig-11 width=70%}

---

- После перезапуска зафиксирована ошибка привязки
- `Permission denied` из-за SELinux
- Служба работала на порту 22

![Ошибка привязки к порту 2022 в статусе sshd](image/12.png){#fig-12 width=70%}

---

- Выполнено `semanage port -a -t ssh_port_t -p tcp 2022`
- Порт открыт в `firewalld`
- Перезапущен `sshd`

![Настройка SELinux и firewall для порта 2022](image/13.png){#fig-13 width=70%}

---

- Проверка статуса показала прослушивание 22 и 2022
- Подтверждена корректная настройка

![sshd прослушивает порты 22 и 2022](image/14.png){#fig-14 width=70%}

---

- Выполнено `ssh -p2022 alkamal@server.alkamal.net`
- Аутентификация успешна
- Выполнен вход и выход из системы

![Успешное SSH-подключение через порт 2022](image/15.png){#fig-15 width=70%}



## Настройка удалённого доступа по SSH по ключу

- В `sshd_config` установлено `PubkeyAuthentication yes`
- Разрешена аутентификация по ключу

![Параметр PubkeyAuthentication yes в sshd\_config](image/16.png){#fig-16 width=70%}

---

- На клиенте выполнено `ssh-keygen`
- Созданы `id_rsa` и `id_rsa.pub`

![Генерация пары SSH-ключей командой ssh-keygen](image/17.png){#fig-17 width=70%}

---

- Выполнено `ssh-copy-id alkamal@server.alkamal.net`
- Ключ добавлен в `authorized_keys`

![Копирование открытого ключа на сервер с помощью ssh-copy-id](image/18.png){#fig-18 width=70%}

---

- Повторное подключение без запроса пароля
- Подтверждена аутентификация по ключу

![Успешная SSH-аутентификация по ключу без ввода пароля](image/19.png){#fig-19 width=70%}



## Организация туннелей SSH, перенаправление TCP-портов

- До туннеля отсутствовал порт 8080
- Проверка `lsof | grep TCP`

![Проверка активных TCP-соединений до создания SSH-туннеля](image/20.png){#fig-20 width=70%}

---

- Выполнено `ssh -fNL 8080:localhost:80 ...`
- Создан локальный туннель 8080 → 80
- Процесс ssh прослушивает порт 8080
- Установлено соединение `ESTABLISHED`

![Прослушивание локального порта 8080 процессом ssh](image/20.png){#fig-20 width=70%}

---

- В браузере открыт `http://localhost:8080`
- Отображена страница сервера
- Подтверждено корректное перенаправление

![Доступ к веб-серверу через SSH-туннель на localhost:8080](image/21.png){#fig-21 width=70%}



## Запуск консольных приложений через SSH

- Выполнено `ssh ... hostname`
- Получено имя узла сервера

![Удалённое выполнение команды hostname через SSH](image/22.png){#fig-22 width=70%}

---

- Выполнено `ssh ... ls -Al`
- Получен список файлов каталога

![Удалённый вывод списка файлов командой ls -Al](image/23.png){#fig-23 width=70%}

---

- Выполнено `ssh ... MAIL=~/Maildir/ mail`
- Отображены 4 почтовых сообщения

![Удалённый просмотр почты через консольное приложение mail](image/24.png){#fig-24 width=70%}



## Запуск графических приложений через SSH (X11Forwarding)

- В `sshd_config` установлено `X11Forwarding yes`
- Разрешена пересылка X11

![Параметр X11Forwarding yes в sshd\_config](image/25.png){#fig-25 width=70%}

---

- Выполнено `ssh -YC ... firefox`
- Включено X11-перенаправление и сжатие
- Firefox запущен на сервере и отображён на клиенте

![Запуск Firefox на сервере с отображением на клиенте через SSH X11Forwarding](image/26.png){#fig-26 width=70%}



## Внесение изменений в настройки внутреннего

- В `/vagrant/provision/server` создан каталог `ssh/etc/ssh`
- Скопирован файл `sshd_config`

![Копирование файла sshd\_config в каталог provision/server/ssh](image/27.png){#fig-27 width=70%}

---

- Создан скрипт `ssh.sh`
- Реализовано копирование конфигурации
- Выполнены `restorecon`, `semanage`, настройка firewall
- Перезапущен `sshd`

![Содержимое скрипта ssh.sh для автоматической настройки SSH](image/28.png){#fig-28 width=70%}

---

- В `Vagrantfile` добавлен provision-блок `shell`
- Указан путь `provision/server/ssh.sh`
- Обеспечено автоматическое выполнение при запуске VM

![Добавление provision-блока для ssh.sh в Vagrantfile](image/29.png){#fig-29 width=70%}



# Выводы
## Выводы

- Запрещён удалённый вход пользователя root
- Ограничен список пользователей через `AllowUsers`
- Настроен альтернативный порт 2022 с учётом SELinux и firewall
- Реализована аутентификация по ключу
- Настроено SSH-туннелирование и перенаправление портов
- Проверен запуск консольных и графических приложений
- Конфигурация интегрирована в provisioning Vagrant
- Обеспечена воспроизводимость и безопасность SSH-доступа
