---
## Author
author:
  name: Ибрахим Мохсейн Алькамаль
  degrees: Student (3 курс)
  orcid: ""
  email: 1032225432@pfur.ru
  affiliation:
    - name: Российский университет дружбы народов
      country: Российская Федерация
      postal-code: 117198
      city: Москва
      address: ул. Миклухо-Маклая, д. 6
## Title
title: Лабораторная работа №13
subtitle: "Дисциплина: Администрирование сетевых подсистем "
license: CC BY
date: today
date-format: "YYYY-MM-DD" # Example: 2025-09-06
---

# Цель работы
## Цель работы

- Приобретение практических навыков настройки сервера NFS
- Организация удалённого доступа к файловым ресурсам

# Выполнение лабораторной работы

## Настройка сервера NFSv4

- Установлен пакет `nfs-utils` через `dnf`
- Обеспечены утилиты и службы NFSv4

![Процесс установки пакета nfs-utils с помощью dnf](image/1.png){#fig-1 width=70%}

---

- Создан каталог `/srv/nfs`
- В `/etc/exports` добавлено `/srv/nfs *(ro)`
- Экспорт с правами только чтения

![Настройка файла /etc/exports с экспортом каталога /srv/nfs](image/2.png){#fig-2 width=70%}

---

- Назначен SELinux-контекст `nfs_t` для `/srv/nfs`
- Использована команда `semanage fcontext`

![Назначение SELinux-контекста nfs\_t для каталога /srv/nfs](image/3.png){#fig-3 width=70%}

---

- Применён `restorecon -vR /srv/nfs`
- Запущен и включён `nfs-server.service`

![Применение restorecon и запуск службы nfs-server](image/4.png){#fig-4 width=70%}

---

- В `firewalld` добавлен сервис `nfs`
- Выполнена перезагрузка конфигурации

![Настройка firewalld для разрешения сервиса NFS](image/5.png){#fig-5 width=70%}

---

- На клиенте установлен пакет `nfs-utils`
- Доступны утилиты `showmount`

![Установка пакета nfs-utils на клиенте](image/6.png){#fig-6 width=70%}

---

- Выполнено `showmount -e server.alkamal.net`
- Получена ошибка RPC
- Причина — ограничения firewall

![Ошибка RPC при выполнении showmount на клиенте](image/7.png){#fig-7 width=70%}

---

- Остановлен `firewalld` на сервере
- Временно сняты сетевые ограничения

![Остановка службы firewalld на сервере](image/8.png){#fig-8 width=70%}

---

- Повторный `showmount -e` выполнен успешно
- Отображён экспорт `/srv/nfs *`

![Успешный вывод showmount с отображением экспорта /srv/nfs](image/9.png){#fig-9 width=70%}

---

- `firewalld` запущен повторно
- Восстановлены правила фильтрации

![Повторный запуск службы firewalld на сервере](image/10.png){#fig-10 width=70%}

---

- Выполнен анализ `lsof | grep TCP/UDP`
- Обнаружены процессы `rpcbind`, `rpc.mountd`, `rpc.statd`
- Подтверждена работа RPC-служб

![Вывод lsof для TCP-соединений служб RPC и NFS](image/11.png){#fig-11 width=70%}

---

![Вывод lsof для UDP-соединений служб RPC и NFS](image/12.png){#fig-12 width=70%}

---

- В `firewalld` добавлены службы `mountd` и `rpc-bind`
- Выполнен `--permanent` и `--reload`

![Добавление служб mountd и rpc-bind в firewalld](image/13.png){#fig-13 width=70%}

---

- Повторный `showmount -e` выполнен успешно
- Подтверждена корректная настройка firewall

![Проверка доступа к экспортируемому ресурсу через showmount](image/14.png){#fig-14 width=70%}



## Монтирование NFS на клиенте

- Создан каталог `/mnt/nfs`
- Выполнено `mount server.alkamal.net:/srv/nfs /mnt/nfs`

![Создание каталога и монтирование NFS-ресурса на клиенте](image/15.png){#fig-15 width=70%}

---

- Проверка `mount` показала тип `nfs4`
- Используется `proto=tcp`, режим `hard`, `sec=sys`

![Вывод mount с отображением подключённого NFSv4-ресурса](image/16.png){#fig-16 width=70%}

---

- В `/etc/fstab` добавлена строка автоматического монтирования
- Использован параметр `_netdev`

![Добавление записи автоматического монтирования в /etc/fstab](image/17.png){#fig-17 width=70%}

---

- Проверен статус `remote-fs.target`
- Состояние `active`

![Проверка состояния remote-fs.target](image/18.png){#fig-18 width=70%}

---

- После перезагрузки ресурс подключён автоматически
- Подтверждён тип `nfs4`

![Подтверждение автоматического монтирования NFS после перезагрузки](image/19.png){#fig-19 width=70%}



## Подключение каталогов к дереву NFS

- Создан каталог `/srv/nfs/www`
- Выполнено `mount -o bind /var/www /srv/nfs/www`
- Проверено наличие `cgi-bin` и `html`

![Создание каталога /srv/nfs/www и bind-монтирование /var/www](image/20.png){#fig-20 width=70%}

---

- На клиенте отображается каталог `www`
- Подтверждён экспорт

![Просмотр каталога /mnt/nfs на клиенте](image/21.png){#fig-21 width=70%}

---

- В `/etc/exports` добавлено `/srv/nfs/www 192.168.0.0/16(rw)`
- Разрешён доступ на чтение и запись

![Добавление экспорта каталога /srv/nfs/www в /etc/exports](image/22.png){#fig-22 width=70%}

---

- Выполнено `exportfs -r`
- Применена новая конфигурация

![Повторная инициализация экспорта NFS с помощью exportfs -r](image/23.png){#fig-23 width=70%}

---

- На клиенте отображаются `cgi-bin` и `html`
- Подтверждён доступ к веб-контенту

![Просмотр содержимого /mnt/nfs/www на клиенте](image/24.png){#fig-24 width=70%}

---

- В `/etc/fstab` добавлено bind-монтирование `/var/www`
- Обеспечено постоянное подключение

![Добавление bind-монтирования в /etc/fstab](image/25.png){#fig-25 width=70%}

---

- Повторно выполнен `exportfs -r`
- Конфигурация актуализирована

![Повторный экспорт каталогов после изменения /etc/fstab](image/26.png){#fig-26 width=70%}

---

- Проверка на клиенте подтверждает доступ
- Настройка выполнена корректно

![Итоговая проверка содержимого /mnt/nfs/www на клиенте](image/27.png){#fig-27 width=70%}



## Подключение каталогов для работы пользователей

- Создан каталог `~/common` с правами `700`
- Создан файл `alkamal@server.txt`
- Права `rwx------`

![Создание каталога common с правами 700 и файла пользователя](image/28.png){#fig-28 width=70%}

---

- В `/etc/exports` добавлено `/srv/nfs/home/alkamal 192.168.0.0/16(rw)`
- Разрешён сетевой доступ

![Добавление каталога пользователя в /etc/exports](image/29.png){#fig-29 width=70%}

---

- В `/etc/fstab` добавлено bind-монтирование каталога пользователя

![Добавление bind-монтирования каталога пользователя в /etc/fstab](image/30.png){#fig-30 width=70%}

---

- Выполнено `exportfs -r`
- Обновлена конфигурация экспорта

![Повторный экспорт каталогов NFS](image/31.png){#fig-31 width=70%}

---

- На клиенте отображаются `home` и `www`
- Подтверждён экспорт пользовательского каталога

![Проверка каталога /mnt/nfs на клиенте](image/32.png){#fig-32 width=70%}

---

- Пользователь alkamal создал файл на клиенте
- Подтверждены права записи

![Создание файла пользователем alkamal на клиенте через NFS](image/33.png){#fig-33 width=70%}

---

- На сервере отображаются оба файла
- Подтверждена синхронность данных

![Проверка появления файла клиента на сервере](image/34.png){#fig-34 width=70%}

---

- При доступе root получено `Permission denied`
- Причина — права `700`

![Отказ в доступе под пользователем root на клиенте](image/35.png){#fig-35 width=70%}



## Внесение изменений в настройки внутреннего

- В `/vagrant/provision/server` создан каталог `nfs/etc`
- Скопирован файл `/etc/exports`

![Копирование файла /etc/exports в каталог provision/server/nfs/etc](image/36.png){#fig-36 width=70%}

---

- Создан скрипт `nfs.sh` для сервера
- Реализована установка `nfs-utils`
- Настроены SELinux, firewall, bind-монтирование
- Запущена и включена служба `nfs-server`

![Содержимое скрипта nfs.sh для виртуальной машины server](image/37.png){#fig-37 width=70%}

---

- На клиенте создан скрипт `nfs.sh`
- Реализованы установка, монтирование и запись в `/etc/fstab`
- Выполнен `restorecon`

![Создание файла nfs.sh в каталоге provision/client](image/38.png){#fig-38 width=70%}

---

![Содержимое скрипта nfs.sh для виртуальной машины client](image/39.png){#fig-39 width=70%}

# Выводы
## Выводы

- Настроен сервер NFSv4 и экспорт каталогов
- Назначены корректные SELinux-контексты `nfs_t`
- Настроен firewall для RPC и NFS-служб
- Реализовано автоматическое монтирование на клиенте
- Организовано bind-монтирование каталогов
- Проверено разграничение доступа по правам файловой системы
- Настройка автоматизирована через provisioning-скрипты
- Обеспечена воспроизводимость инфраструктуры NFS
