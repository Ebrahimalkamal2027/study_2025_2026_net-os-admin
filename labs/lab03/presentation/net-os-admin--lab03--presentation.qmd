---
## Author
author:
  name: Ибрахим Мохсейн Алькамаль
  degrees: Student (3 курс)
  orcid: ""
  email: 1032225432@pfur.ru
  affiliation:
    - name: Российский университет дружбы народов
      country: Российская Федерация
      postal-code: 117198
      city: Москва
      address: ул. Миклухо-Маклая, д. 6
## Title
title: Лабораторная работа №3
subtitle: "Дисциплина: Администрирование сетевых подсистем "
license: CC BY
date: today
date-format: "YYYY-MM-DD" # Example: 2025-09-06
---

# Цель работы
## Цель работы

- Приобретение практических навыков установки и конфигурирования DHCP-сервера


# Выполнение лабораторной работы

## Установка DHCP-сервера

- Переход в режим суперпользователя
- Установка DHCP-сервера Kea через `dnf`

![Установка пакета kea через dnf](image/1.png){#fig-1 width=70%}



## Конфигурирование DHCP-сервера

- Отредактирован `/etc/kea/kea-dhcp4.conf`
- Указан интерфейс `eth1`
- Настроен DNS `192.168.1.1`
- Задан домен `alkamal.net`
- Определена подсеть `192.168.1.0/24`
- Диапазон `192.168.1.30–192.168.1.199`
- Указан шлюз `192.168.1.1`

![Конфигурация файла kea-dhcp4.conf](image/2.png){#fig-2 width=70%}

---

- Выполнена проверка `kea-dhcp4 -t`
- Ошибки отсутствуют
- Прослушивание на `eth1` активно

![Проверка конфигурации kea-dhcp4 -t](image/3.png){#fig-3 width=70%}

---

- В прямую зону добавлена A-запись `dhcp.alkamal.net`
- Обновлён серийный номер зоны

![Файл прямой DNS-зоны fz/alkamal.net](image/4.png){#fig-4 width=70%}

---

- В обратную зону добавлена PTR-запись
- Связь `192.168.1.1` → `dhcp.alkamal.net`
- Обновлён серийный номер

![Файл обратной DNS-зоны rz/192.168.1](image/5.png){#fig-5 width=70%}

---

- Перезапущена служба `named`
- Проверено разрешение `dhcp.alkamal.net`
- Потерь пакетов нет

![Проверка разрешения имени dhcp.alkamal.net командой ping](image/6.png){#fig-6 width=70%}

---

- В `firewalld` добавлена служба `dhcp`
- Правило добавлено в текущую и постоянную конфигурацию
- Восстановлены SELinux-контексты

![Настройка firewalld и восстановление контекстов SELinux](image/7.png){#fig-7 width=70%}

---

- Выполнен мониторинг `/var/log/messages`
- Запущена служба `kea-dhcp4.service`
- Состояние — рабочее

![Мониторинг журнала и запуск kea-dhcp4.service](image/8.png){#fig-8 width=70%}


## Анализ работы DHCP-сервера

- Создан скрипт `01-routing.sh`
- Настроен шлюз `192.168.1.1` для `eth1`
- Отключён `eth0` как default-route

![Скрипт 01-routing.sh для настройки маршрутизации клиента](image/9.png){#fig-9 width=70%}

---

- Скрипт подключён в `Vagrantfile`
- Параметр `run: "always"`

![Подключение provisioning-скрипта в Vagrantfile](image/10.png){#fig-10 width=70%}

---

- В `/var/lib/kea/kea-leases4.csv` зафиксирована аренда `192.168.1.30`
- MAC клиента `08:00:27:ef:c7:e6`
- Время аренды 7200 секунд
- Подсеть ID 1
- Имя клиента `client`

![Файл kea-leases4.csv с выданными арендами](image/11.png){#fig-11 width=70%}

---

- Выполнена команда `ifconfig` на клиенте
- `eth0` — `10.0.2.15/24` (NAT)
- `eth1` — `192.168.1.30/24` (DHCP)
- Подтверждён MAC-адрес

![Вывод команды ifconfig на клиенте](image/12.png){#fig-12 width=70%}

---

- Повторная проверка leases
- Аренда активна
- DHCP работает корректно

![Повторная проверка списка выданных адресов](image/13.png){#fig-13 width=70%}


## Настройка обновления DNS-зоны

- Создан каталог `/etc/named/keys`
- Сгенерирован TSIG-ключ `DHCP_UPDATER` (HMAC-SHA512)
- Настроены права доступа

![Создание TSIG-ключа и настройка прав доступа](image/14.png){#fig-14 width=70%}

---

- В файле `dhcp_updater.key` указаны имя, алгоритм и секрет

![Содержимое файла dhcp\_updater.key](image/15.png){#fig-15 width=70%}

---

- В `named.conf` добавлена директива `include` для ключа

![Подключение TSIG-ключа в named.conf](image/16.png){#fig-16 width=70%}

---

- В зонах добавлена `update-policy`
- Разрешено обновление A- и PTR-записей
- Используется механизм DHCID

![Настройка update-policy для прямой и обратной зоны](image/17.png){#fig-17 width=70%}

---

- Проверка `named-checkconf`
- Перезапуск `named`
- Ошибки отсутствуют

![Проверка конфигурации и перезапуск named](image/18.png){#fig-18 width=70%}

---

- Создан `/etc/kea/tsig-keys.json`
- Перенесён секретный ключ
- Владелец `kea:kea`, права 640

![Создание и настройка файла tsig-keys.json для Kea](image/19.png){#fig-19 width=70%}

---

- В файле описан ключ `DHCP_UPDATER`
- Алгоритм `hmac-sha512`

![Содержимое файла tsig-keys.json](image/20.png){#fig-20 width=70%}

---

- Настроен `/etc/kea/kea-dhcp-ddns.conf`
- Адрес `127.0.0.1`, порт `53001`
- Подключён `tsig-keys.json`
- Указаны зоны `alkamal.net.` и `1.168.192.in-addr.arpa.`

![Конфигурация kea-dhcp-ddns.conf](image/21.png){#fig-21 width=70%}

---

- Проверка `kea-dhcp-ddns -t`
- Служба запущена
- Статус `active (running)`

![Проверка конфигурации и запуск kea-dhcp-ddns](image/22.png){#fig-22 width=70%}

---

- В `kea-dhcp4.conf` включены:
- `"enable-updates": true`
- `"ddns-qualifying-suffix": "alkamal.net"`
- `"ddns-override-client-update": true`

![Включение динамических обновлений в kea-dhcp4.conf](image/23.png){#fig-23 width=70%}

---

- Проверка `kea-dhcp4 -t`
- Перезапуск `kea-dhcp4.service`
- Статус `active (running)`

![Проверка и перезапуск kea-dhcp4](image/24.png){#fig-24 width=70%}

---

- На клиенте выполнено переполучение IP (`nmcli down/up`)
- Инициировано динамическое обновление DNS

![Переполучение IP-адреса на клиенте](image/25.png){#fig-25 width=70%}

---

- В каталоге зоны появился файл `alkamal.net.jnl`
- Подтверждено динамическое обновление

![Появление файла зоны alkamal.net.jnl](image/26.png){#fig-26 width=70%}



## Анализ работы DHCP-сервера после настройки обновления DNS-зоны

- Выполнен `dig @192.168.1.1 client.alkamal.net`
- Статус `NOERROR`
- Флаг `aa` — сервер авторитетный
- Получена запись `A 192.168.1.30`
- TTL 2400 секунд

![Проверка DNS-записи клиента командой dig](image/27.png){#fig-27 width=70%}



## Внесение изменений в настройки внутреннего окружения виртуальной машины

- Создан каталог `/vagrant/provision/server/dhcp/etc/kea`
- Скопированы конфигурации DHCP и DNS

![Копирование конфигураций DHCP и DNS в каталог provisioning](image/28.png){#fig-28 width=70%}

---

- Создан скрипт `dhcp.sh`
- Установка `kea`
- Копирование конфигураций
- Настройка прав доступа
- Восстановление SELinux
- Настройка firewalld
- Запуск `kea-dhcp4` и `kea-dhcp-ddns`

![Содержимое provisioning-скрипта dhcp.sh](image/29.png){#fig-29 width=70%}

---

- В `Vagrantfile` добавлен provision-блок
- Путь `provision/server/dhcp.sh`
- Сохранён порядок выполнения

![Подключение dhcp.sh в Vagrantfile](image/30.png){#fig-30 width=70%}


# Выводы
## Выводы

- Установлен и настроен DHCP-сервер Kea
- Реализована выдача адресов в сети `192.168.1.0/24`
- Настроено динамическое обновление DNS через TSIG
- Подтверждено создание записи `client.alkamal.net`
- Проверена корректность работы DHCP и DDNS
- Зафиксированы аренды в `kea-leases4.csv`
- Реализована автоматизация через `dhcp.sh` и `Vagrantfile`
