---
## Author
author:
  name: Ибрахим Мохсейн Алькамаль
  degrees: Student (3 курс)
  orcid: ""
  email: 1032225432@pfur.ru
  affiliation:
    - name: Российский университет дружбы народов
      country: Российская Федерация
      postal-code: 117198
      city: Москва
      address: ул. Миклухо-Маклая, д. 6
## Title
title: Лабораторная работа №7
subtitle: "Дисциплина: Администрирование сетевых подсистем "
license: CC BY
date: today
date-format: "YYYY-MM-DD" # Example: 2025-09-06
---

# Цель работы
## Цель работы

- Получение навыков настройки межсетевого экрана в Linux
- Реализация переадресации портов
- Настройка Masquerading


# Выполнение лабораторной работы

## Создание пользовательской службы firewalld

- Выполнен переход в режим суперпользователя
- Скопирован файл `ssh.xml` в `ssh-custom.xml`
- Файл размещён в `/etc/firewalld/services/`

![Копирование файла службы ssh.xml в ssh-custom.xml](image/1.png){#fig-1 width=70%}

---

- В файле изменён порт с `22` на `2022`
- Обновлено описание службы
- Проверено содержимое файла

![Редактирование службы: изменение порта на 2022 и обновление описания](image/2.png){#fig-2 width=70%}

---

- Получен список служб `--get-services`
- Выполнена перезагрузка `firewall-cmd --reload`
- Служба `ssh-custom` добавлена в активные
- Добавлена в постоянную конфигурацию

![Добавление и активация пользовательской службы ssh-custom в firewalld](image/3.png){#fig-3 width=70%}

---

![Добавление и активация пользовательской службы ssh-custom в firewalld](image/4.png){#fig-4 width=70%}



## Перенаправление портов

- Настроено правило перенаправления:
- `2022 → 22` (TCP)
- Правило добавлено в текущую конфигурацию

![Настройка перенаправления порта 2022 на 22 в firewalld](image/5.png){#fig-5 width=70%}

---

- С клиента выполнено подключение:
- `ssh -p 2022 alkamal@server.alkamal.net`
- Подтверждена успешная авторизация
- Проверена работа перенаправления

![Подключение по SSH к серверу через порт 2022 с клиента](image/6.png){#fig-6 width=70%}

---

- Проверен параметр `net.ipv4.ip_forward`
- Значение — `0` (маршрутизация отключена)

![Проверка параметров пересылки IPv4 в ядре системы](image/7.png){#fig-7 width=70%}

---

- Создан файл `/etc/sysctl.d/90-forward.conf`
- Установлено `net.ipv4.ip_forward = 1`
- Применена конфигурация `sysctl -p`
- Включён masquerade в зоне `public`
- Выполнен `firewall-cmd --reload`

![Проверка параметров пересылки IPv4 в ядре системы](image/7.png){#fig-7 width=70%}

---

- С клиента выполнены `ping 8.8.8.8` и `ping google.com`
- Потерь пакетов нет
- Подтверждён выход в Интернет через сервер

![Проверка доступа в Интернет с клиента после включения IP-forward и masquerade](image/8.png){#fig-8 width=70%}



## Внесение изменений в настройки внутреннего

- Созданы каталоги:
- `firewall/etc/firewalld/services`
- `firewall/etc/sysctl.d`
- Скопированы `ssh-custom.xml` и `90-forward.conf`

![Создание структуры каталогов и копирование конфигурационных файлов FirewallD](image/9.png){#fig-9 width=70%}

---

- Создан скрипт `firewall.sh`
- Реализовано:
- копирование конфигураций в `/etc`
- добавление службы `ssh-custom`
- перенаправление `2022 → 22`
- включение masquerade
- перезагрузка firewalld
- восстановление SELinux-контекстов

![Содержимое provisioning-скрипта firewall.sh](image/10.png){#fig-10 width=70%}

---

- В `Vagrantfile` добавлен provision-блок
- Тип `shell`
- Путь `provision/server/firewall.sh`
- Указан `preserve_order: true`

![Добавление provisioning-скрипта firewall.sh в Vagrantfile](image/11.png){#fig-11 width=70%}

# Выводы
## Выводы

- Создана пользовательская служба `ssh-custom` (порт 2022)
- Реализовано перенаправление `2022 → 22`
- Подтверждён SSH-доступ через нестандартный порт
- Включена маршрутизация IPv4 (`ip_forward = 1`)
- Настроен masquerading в зоне `public`
- Подтверждён выход клиента в Интернет через сервер
- Реализована автоматизация через `firewall.sh` и `Vagrantfile`
