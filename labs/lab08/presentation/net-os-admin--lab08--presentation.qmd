---
## Author
author:
  name: Ибрахим Мохсейн Алькамаль
  degrees: Student (3 курс)
  orcid: ""
  email: 1032225432@pfur.ru
  affiliation:
    - name: Российский университет дружбы народов
      country: Российская Федерация
      postal-code: 117198
      city: Москва
      address: ул. Миклухо-Маклая, д. 6
## Title
title: Лабораторная работа №8
subtitle: "Дисциплина: Администрирование сетевых подсистем "
license: CC BY
date: today
date-format: "YYYY-MM-DD" # Example: 2025-09-06
---

# Цель работы
## Цель работы

- Приобретение практических навыков установки SMTP-сервера
- Освоение конфигурирования Postfix

# Выполнение лабораторной работы

## Переход в режим суперпользователя

- Выполнен вход на виртуальную машину `server`
- Выполнена команда `sudo -i`
- Получено приглашение `root@server.alkamal.net`

![Переход в режим суперпользователя на сервере](image/1.png){#fig-1 width=70%}

## Установка пакетов Postfix и s-nail

- Установлены пакеты `postfix` и `s-nail` через `dnf`
- Разрешены зависимости
- Установка завершена без ошибок

![Установка пакетов postfix и s-nail с помощью dnf](image/2.png){#fig-2 width=70%}

## Настройка межсетевого экрана для службы SMTP

- Разрешена служба `smtp` через `firewall-cmd`
- Изменения применены к текущей и постоянной конфигурации
- Проверка `--list-services` подтвердила наличие `smtp`

![Разрешение службы SMTP в firewalld](image/3.png){#fig-3 width=70%}

## Восстановление контекста безопасности SELinux

- Выполнена команда `restorecon -vR /etc`
- Восстановлены корректные контексты безопасности
- Подтверждено изменение контекста конфигурационного файла

![Восстановление контекста безопасности SELinux](image/3.png){#fig-3 width=70%}

## Запуск и активация службы Postfix

- Выполнено `systemctl enable postfix`
- Выполнено `systemctl start postfix`
- Проверка `systemctl status postfix` — состояние `active (running)`

![Статус службы Postfix после запуска](image/4.png){#fig-4 width=70%}

## Просмотр текущих параметров Postfix

- Выполнена команда `postconf`
- Отображён список активных параметров
- Проверены параметры адресации и транспортов

![Вывод команды postconf — список текущих параметров](image/5.png){#fig-5 width=70%}

## Проверка параметров myorigin и mydomain

- Проверено значение `myorigin = $myhostname`
- Проверено значение `mydomain = alkamal.net`
- Установлено `myorigin = $mydomain`
- Выполнены `postfix check` и `systemctl reload postfix`
- Проверка `postconf -n` подтвердила изменения

![Изменение параметра myorigin и проверка конфигурации](image/6.png){#fig-6 width=70%}

## Жёсткая установка домена и отключение IPv6

- Установлено `mydomain = alkamal.net`
- Проверено `inet_protocols = all`
- Установлено `inet_protocols = ipv4`
- Выполнены `postfix check` и `systemctl reload postfix`

![Настройка параметров mydomain и inet\_protocols](image/7.png){#fig-7 width=70%}

### 1. Отправка тестового сообщения с сервера

- Отправлено письмо `test1` пользователю `alkamal@server.alkamal.net`

![Отправка письма test1 с сервера](image/8.png){#fig-8 width=70%}

---

### 2. Анализ журналов и локальной доставки на сервере

- Выполнен мониторинг `/var/log/maillog`
- Обнаружено `status=sent (delivered to mailbox)`
- Обнаружено `removed`
- Проверен каталог `/var/spool/mail`
- Подтверждено получение письма пользователем

![Мониторинг maillog при локальной отправке](image/9.png){#fig-9 width=70%}

![Содержимое почтового ящика пользователя](image/10.png){#fig-10 width=70%}

## Установка Postfix и s-nail на клиенте

- На машине `client` установлены `postfix` и `s-nail`
- Установка завершена успешно

![Установка postfix на клиенте](image/11.png){#fig-11 width=70%}

![Установка s-nail на клиенте](image/12.png){#fig-12 width=70%}

## Настройка протоколов и запуск Postfix на клиенте

- Проверено значение `inet_protocols`
- Установлено `inet_protocols = ipv4`
- Служба добавлена в автозагрузку
- Выполнен запуск Postfix

![Настройка inet\_protocols и запуск Postfix на клиенте](image/13.png){#fig-13 width=70%}

## Повторная отправка письма с клиента

- Отправлено письмо `test2` на `alkamal@server.alkamal.net`

![Отправка письма test2 с клиента](image/14.png){#fig-14 width=70%}

## Проверка сетевых параметров на сервере

- Проверено `inet_interfaces = localhost`
- Проверено `mynetworks = 127.0.0.1/32`
- Подтвержден приём только локальных соединений

![Просмотр параметров inet\_interfaces и mynetworks](image/15.png){#fig-15 width=70%}

## Разрешение сетевых соединений

- Установлено `inet_interfaces = all`
- Установлено `mynetworks = 127.0.0.0/8, 192.168.0.0/16`
- Выполнены `postfix check`, перезагрузка и перезапуск службы

![Изменение параметров сети Postfix](image/15.png){#fig-15 width=70%}

## Повторная отправка письма после изменения конфигурации

- Письмо с клиента успешно доставлено
- В заголовке: `Received: from client.alkamal.net (192.168.1.30)`
- В журнале: `status=sent (delivered to mailbox)`

![Заголовки письма, полученного с клиента](image/16.png){#fig-16 width=70%}

![Запись в журнале о доставке письма с клиента](image/18.png){#fig-18 width=70%}

## Настройка прямой DNS-зоны с MX-записью

- В файл зоны добавлена запись `MX 10 mail.alkamal.net.`
- Добавлена A-запись `mail → 192.168.1.1`
- Обеспечена маршрутизация почты домена

![Файл прямой DNS-зоны с MX-записью](image/19.png){#fig-19 width=70%}

## Настройка обратной DNS-зоны

- Добавлены PTR-записи для `192.168.1.1`
- Связаны имена: server, ns, dhcp, www, mail
- Обеспечено корректное обратное разрешение

![Файл обратной DNS-зоны с PTR-записями](image/20.png){#fig-20 width=70%}

## Добавление домена в параметры mydestination

- Установлено значение `mydestination`
- Выполнены `postfix check` и `systemctl reload postfix`
- Восстановлены контексты SELinux
- Перезапущена служба `named`
- Выполнена обработка очереди `postqueue -f`

![Настройка mydestination и перезапуск служб](image/21.png){#fig-21 width=70%}

## Отправка письма на доменный адрес с клиента

- Отправлено письмо `test3` на `alkamal@alkamal.net`

![Отправка письма на доменный адрес](image/22.png){#fig-22 width=70%}

## Проверка доставки сообщения

- В журнале обнаружено `status=sent (delivered to mailbox)`
- Подтверждена корректная доставка после настройки MX и `mydestination`

![Журнал Postfix с подтверждением доставки](image/23.png){#fig-23 width=70%}

## Копирование конфигурации DNS в каталог provision сервера

- Выполнен переход в каталог provision
- Скопированы файлы из `/var/named`
- Подтверждена перезапись файлов зоны

![Копирование файлов DNS в каталог provision](image/24.png){#fig-24 width=70%}

## Создание скрипта mail.sh на сервере

- Создан исполняемый файл `mail.sh`
- Добавлена установка `postfix` и `s-nail`
- Настроен firewall и SELinux
- Настроены параметры `mydomain`, `myorigin`, `inet_protocols`, `inet_interfaces`, `mynetworks`, `mydestination`
- Выполнен перезапуск службы

![Содержимое mail.sh на сервере](image/25..png){#fig-25 width=70%}

## Создание скрипта mail.sh на клиенте

- Создан файл `mail.sh` в каталоге provision
- Сделан исполняемым

![Создание mail.sh на клиенте](image/26.png){#fig-26 width=70%}

- Установлены `postfix` и `s-nail`
- Установлено `inet_protocols = ipv4`
- Добавлена автозагрузка службы
- Выполнен запуск Postfix

![Содержимое mail.sh на клиенте](image/27.png){#fig-27 width=70%}

## Добавление provisioning-скрипта для сервера в Vagrantfile

- Добавлен блок `server.vm.provision`
- Указан путь `provision/server/mail.sh`
- Обеспечена автоматическая настройка сервера

![Добавление provisioning для сервера в Vagrantfile](image/28.png){#fig-28 width=70%}

## Добавление provisioning-скрипта для клиента в Vagrantfile

- Добавлен блок `client.vm.provision`
- Указан путь `provision/client/mail.sh`
- Обеспечена автоматическая настройка клиента

![Добавление provisioning для клиента в Vagrantfile](image/29.png){#fig-29 width=70%}

# Выводы
## Выводы

- Выполнена полная настройка Postfix в домене `alkamal.net`
- Настроены параметры сети и безопасности
- Реализована локальная и сетевая доставка почты
- Настроены MX и PTR-записи DNS
- Проверена доставка сообщений по доменному имени
- Реализована автоматизация настройки через provisioning-скрипты
